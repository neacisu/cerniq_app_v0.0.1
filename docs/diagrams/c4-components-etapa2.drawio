<mxfile host="app.diagrams.net" modified="2026-02-02T00:00:00.000Z" agent="Cerniq Development Team" version="22.1.0" type="device">
  <diagram id="etapa2-components" name="Etapa 2 - Cold Outreach Components">
    <mxGraphModel dx="2074" dy="1156" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- ================================================================== -->
        <!-- TITLE AND LEGEND -->
        <!-- ================================================================== -->
        <mxCell id="title" value="CERNIQ.APP — ETAPA 2: C4 COMPONENT DIAGRAM&#10;Cold Outreach Multi-Canal Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="477" y="20" width="700" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1400" y="80" width="230" height="180" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="LEGEND" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1480" y="85" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-api" value="API Container" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1410" y="110" width="100" height="25" as="geometry" />
        </mxCell>
        <mxCell id="legend-worker" value="Worker Container" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1410" y="140" width="100" height="25" as="geometry" />
        </mxCell>
        <mxCell id="legend-db" value="Database" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1410" y="170" width="60" height="35" as="geometry" />
        </mxCell>
        <mxCell id="legend-external" value="External System" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1410" y="210" width="100" height="25" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- EXTERNAL SYSTEMS (TOP) -->
        <!-- ================================================================== -->
        <mxCell id="ext-systems-group" value="External Systems" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="350" y="90" width="900" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="timelinesai" value="TimelinesAI&#10;[External Service]&#10;WhatsApp Business API&#10;20 phone numbers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="380" y="130" width="180" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="instantly" value="Instantly.ai&#10;[External Service]&#10;Cold Email Platform&#10;Warmup + Inbox Rotation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="610" y="130" width="180" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="resend" value="Resend&#10;[External Service]&#10;Warm Email Platform&#10;Transactional Email" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="840" y="130" width="180" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="xai-grok" value="xAI Grok-4&#10;[External Service]&#10;LLM for Sentiment&#10;Analysis &amp; Response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="1070" y="130" width="150" height="70" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- API LAYER -->
        <!-- ================================================================== -->
        <mxCell id="api-container" value="API Container [Fastify v5.6.2]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="30" y="250" width="350" height="280" as="geometry" />
        </mxCell>
        
        <mxCell id="api-outreach" value="Outreach API Module&#10;[Fastify Plugin]&#10;&#10;35+ REST Endpoints&#10;- /api/v1/outreach/leads&#10;- /api/v1/outreach/sequences&#10;- /api/v1/outreach/templates&#10;- /api/v1/outreach/phones&#10;- /api/v1/outreach/reviews&#10;- /api/v1/outreach/analytics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="45" y="290" width="160" height="160" as="geometry" />
        </mxCell>
        
        <mxCell id="api-webhooks" value="Webhook Handlers&#10;[Fastify Plugin]&#10;&#10;- POST /webhooks/timelinesai&#10;- POST /webhooks/instantly&#10;- POST /webhooks/resend&#10;&#10;Signature Verification&#10;Async Queue Dispatch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=10;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="215" y="290" width="155" height="160" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- REDIS + BULLMQ LAYER -->
        <!-- ================================================================== -->
        <mxCell id="redis-container" value="Message Queue [Redis 8.4.0 + BullMQ v5.66.5]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="400" y="250" width="850" height="130" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-quota" value="quota:*&#10;[Quota Guardian]&#10;4 queues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="415" y="290" width="90" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-orchestrator" value="outreach:*&#10;[Orchestration]&#10;4 queues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="515" y="290" width="90" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-wa" value="q:wa:phone{1-20}&#10;[WhatsApp]&#10;20 queues + 7 workers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="615" y="290" width="130" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-email-cold" value="q:email:cold*&#10;[Email Cold]&#10;5 queues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="755" y="290" width="90" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-email-warm" value="q:email:warm*&#10;[Email Warm]&#10;3 queues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="855" y="290" width="90" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-ai" value="ai:*&#10;[AI Analysis]&#10;3 queues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="955" y="290" width="90" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-human" value="human:*&#10;[HITL Review]&#10;4 queues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="1055" y="290" width="90" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queue-sequences" value="sequence:*&#10;[Follow-up]&#10;4 queues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="1155" y="290" width="80" height="70" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- WORKERS LAYER - Category A: Quota Guardian -->
        <!-- ================================================================== -->
        <mxCell id="workers-quota" value="Category A: Quota Guardian [4 Workers]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=25;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="30" y="560" width="250" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-quota-check" value="#1 QuotaGuardianCheck&#10;Redis Lua atomic quota validation&#10;Concurrency: 100 | Timeout: 2s" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="590" width="230" height="45" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-quota-reset" value="#2 QuotaDailyReset&#10;Midnight reset per timezone&#10;Cron: 0 0 * * *" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="640" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-quota-persist" value="#3-4 QuotaPersist/Sync&#10;Redis → PostgreSQL sync&#10;Every 5 minutes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="155" y="640" width="115" height="55" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- WORKERS LAYER - Category B: Orchestration -->
        <!-- ================================================================== -->
        <mxCell id="workers-orchestration" value="Category B: Orchestration [4 Workers]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=25;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="300" y="560" width="280" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-dispatch" value="#5 OutreachDispatcher&#10;Assigns leads to channels&#10;Cron: */5 * * * * | Concurrency: 50" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="310" y="590" width="260" height="45" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-phone-assign" value="#6 PhoneAssigner (STICKY)&#10;Permanent phone↔lead binding&#10;ADR-0055 compliant" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="310" y="640" width="130" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-retry" value="#7-8 RetryOrchestrator&#10;Failed job reprocessing&#10;Exponential backoff" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="445" y="640" width="125" height="55" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- WORKERS LAYER - Category C: WhatsApp -->
        <!-- ================================================================== -->
        <mxCell id="workers-whatsapp" value="Category C: WhatsApp [7 Workers + 20 Queues]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=25;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="600" y="560" width="300" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-wa-sender" value="#9 WASender (×20 queues)&#10;One queue per phone number&#10;Head-of-line blocking prevention (ADR-0060)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="610" y="590" width="280" height="45" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-wa-jitter" value="#10 WAJitter&#10;30s + rand(0,120s)&#10;Human-like delays" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="610" y="640" width="90" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-wa-status" value="#11-12 WAStatus&#10;Delivery tracking&#10;Read receipts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="705" y="640" width="90" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-wa-health" value="#13-15 WAHealth&#10;Phone monitoring&#10;Status sync" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="800" y="640" width="90" height="55" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- WORKERS LAYER - Category D-E: Email -->
        <!-- ================================================================== -->
        <mxCell id="workers-email" value="Category D-E: Email [8 Workers]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=25;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="920" y="560" width="330" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-email-cold" value="#16-20 EmailColdSender&#10;Instantly.ai integration&#10;ADR-0059: Strict cold/warm segregation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="930" y="590" width="150" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-email-warm" value="#21-23 EmailWarmSender&#10;Resend integration&#10;For replied leads only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1090" y="590" width="150" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-bounce" value="#24 BounceCircuitBreaker&#10;3% threshold → campaign pause&#10;ADR-0066 compliant" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="930" y="650" width="160" height="45" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-email-track" value="#25 EmailTracker&#10;Open/Click tracking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1095" y="650" width="145" height="45" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- WORKERS LAYER - Category F-L: Supporting -->
        <!-- ================================================================== -->
        <mxCell id="workers-supporting" value="Category F-L: Templates, AI, HITL, Sequences, Monitoring [27 Workers]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=25;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="30" y="730" width="1220" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-template" value="F: Templates&#10;#26-28&#10;SpintaxExpander&#10;VariableResolver&#10;TemplateValidator" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="40" y="760" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-webhook" value="G: Webhooks&#10;#29-32&#10;TimelinesAIHandler&#10;InstantlyHandler&#10;ResendHandler&#10;WebhookNormalizer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="150" y="760" width="110" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-sequence" value="H: Sequences&#10;#33-36&#10;SequenceScheduler&#10;StepExecutor&#10;SequencePauser&#10;EnrollmentManager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="270" y="760" width="110" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-fsm" value="I: State Machine&#10;#37-39&#10;LeadStateTransition&#10;StateHistoryLogger&#10;TransitionValidator" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="390" y="760" width="110" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-ai" value="J: AI Analysis&#10;#40-42&#10;SentimentAnalyzer&#10;ResponseGenerator&#10;IntentClassifier&#10;xAI Grok-4 client" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="510" y="760" width="110" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-monitor" value="K: Monitoring&#10;#43-48&#10;QuotaMonitor&#10;PhoneHealthMonitor&#10;BounceRateMonitor&#10;AlertDispatcher&#10;DailyStatsAggregator&#10;SLATracker" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="630" y="760" width="120" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="worker-hitl" value="L: Human Review&#10;#49-52&#10;ReviewQueueManager&#10;SLAEnforcer&#10;EscalationHandler&#10;ReviewResolver" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;verticalAlign=top;spacingTop=3;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="760" y="760" width="115" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="constraints-box" value="BUSINESS CONSTRAINTS&#10;• WhatsApp: 200 NEW/day/phone&#10;• Follow-ups: UNLIMITED&#10;• Business hours: 09:00-18:00&#10;• Jitter: 30s + rand(0,120s)&#10;• Bounce threshold: 3%&#10;• SLA Urgent: 1h, High: 4h" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="885" y="760" width="160" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="adrs-box" value="KEY ADRs&#10;• ADR-0053: Multi-Channel&#10;• ADR-0054: Quota Guardian&#10;• ADR-0055: Sticky Phone&#10;• ADR-0060: HOL Prevention&#10;• ADR-0062: Lead FSM&#10;• ADR-0066: Circuit Breaker" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1055" y="760" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- DATABASE LAYER -->
        <!-- ================================================================== -->
        <mxCell id="db-container" value="Database Layer [PostgreSQL 18.1 + PostGIS]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=25;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="30" y="870" width="1220" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="table-journey" value="gold_lead_journey&#10;[Table]&#10;FSM state tracking&#10;~50K rows/month" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="50" y="905" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="table-comms" value="gold_communication_log&#10;[Table]&#10;Message audit trail&#10;~500K rows/month" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="170" y="905" width="110" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="table-phones" value="wa_phone_numbers&#10;[Table]&#10;20 phone records&#10;Status + Health" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="300" y="905" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="table-quota" value="wa_quota_usage&#10;[Table]&#10;Daily quota audit&#10;~600 rows/month" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="420" y="905" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="table-sequences" value="outreach_sequences&#10;sequence_steps&#10;sequence_enrollments&#10;[Tables]" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="540" y="905" width="110" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="table-templates" value="outreach_templates&#10;template_versions&#10;[Tables]&#10;A/B testing support" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="670" y="905" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="table-review" value="human_review_queue&#10;[Table]&#10;HITL items + SLA&#10;~10K rows/month" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="790" y="905" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="table-stats" value="outreach_daily_stats&#10;[Table]&#10;Aggregated metrics&#10;~365 rows/year" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="910" y="905" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="redis-lua" value="Redis Lua Scripts&#10;[Quota Check]&#10;Atomic operations&#10;48h TTL keys" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1030" y="905" width="100" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="gold-layer" value="Gold Layer&#10;(from Etapa 1)&#10;gold_companies&#10;Input source" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1140" y="905" width="90" height="70" as="geometry" />
        </mxCell>

        <!-- ================================================================== -->
        <!-- FRONTEND LAYER -->
        <!-- ================================================================== -->
        <mxCell id="frontend-container" value="Frontend [React 19 + Refine v5 + Tailwind v4]" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=25;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="30" y="1020" width="1220" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="page-dashboard" value="/outreach/dashboard&#10;KPIs, QuotaGrid&#10;Channel Performance&#10;Lead Funnel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="50" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="page-leads" value="/outreach/leads&#10;DataTable + Filters&#10;Bulk Actions&#10;Quick View" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="170" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="page-lead-detail" value="/outreach/leads/[id]&#10;Conversation View&#10;Timeline&#10;Send Message" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="290" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="page-sequences" value="/outreach/sequences&#10;Sequence Builder&#10;Step Configuration&#10;Enrollment Stats" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="410" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="page-templates" value="/outreach/templates&#10;Template Editor&#10;Spintax Preview&#10;A/B Testing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="530" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="page-phones" value="/outreach/phones&#10;Phone Grid (20)&#10;Quota Progress&#10;Health Status" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="650" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="page-review" value="/outreach/review&#10;Priority Tabs&#10;Review Cards&#10;Quick Actions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="770" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="page-analytics" value="/outreach/analytics&#10;Charts (Recharts)&#10;Date Range Filter&#10;Export Reports" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="890" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="components" value="Shared Components&#10;QuotaUsageGrid&#10;ConversationTimeline&#10;SentimentBadge&#10;ChannelSelector" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1010" y="1055" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="realtime" value="Real-time Updates&#10;React Query v5&#10;WebSocket events&#10;Optimistic UI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1130" y="1055" width="100" height="55" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
