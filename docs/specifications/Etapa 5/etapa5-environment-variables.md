# CERNIQ.APP â€” ETAPA 5: ENVIRONMENT VARIABLES
## Complete Environment Configuration
### Versiunea 1.0 | 19 Ianuarie 2026

> **ðŸ“Œ NotÄƒ (Februarie 2026):** Sintaxa `${DOCKER_SECRET:name}` din acest document este un placeholder.
> ÃŽn producÈ›ie, secretele sunt gestionate prin **OpenBao** (nu Docker secrets).
> ConsultÄƒ [ADR-0033](../../adr/ADR%20Etapa%200/ADR-0033-OpenBao-Secrets-Management.md) È™i
> [openbao-setup-guide.md](../../infrastructure/openbao-setup-guide.md) pentru implementarea efectivÄƒ.

---

## 1. Core Application

```bash
# Application
NODE_ENV=production
APP_NAME=cerniq-nurturing
APP_VERSION=5.0.0
APP_PORT=64050

# Database
POSTGRES_HOST=postgres
POSTGRES_PORT=64032
POSTGRES_USER=cerniq_e5
POSTGRES_PASSWORD=${DOCKER_SECRET:cerniq_e5_db_password}
POSTGRES_DB=cerniq_nurturing
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Redis
REDIS_HOST=redis
REDIS_PORT=64039
REDIS_PASSWORD=${DOCKER_SECRET:redis_password}
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}

# BullMQ Queues Prefix
BULLMQ_PREFIX=e5
```

---

## 2. LLM Integration (Anthropic)

```bash
# Anthropic API
ANTHROPIC_API_KEY=${DOCKER_SECRET:anthropic_api_key}
ANTHROPIC_MODEL=claude-sonnet-4-20250514
ANTHROPIC_MAX_TOKENS=4096

# Rate Limiting
ANTHROPIC_RATE_LIMIT_RPM=100
ANTHROPIC_RATE_LIMIT_TPM=100000
ANTHROPIC_COST_LIMIT_DAILY_USD=50

# Sentiment Analysis
SENTIMENT_BATCH_SIZE=10
SENTIMENT_MAX_RETRIES=3
SENTIMENT_TIMEOUT_MS=30000
```

---

## 3. Python Graph Service

```bash
# Python Graph Service
GRAPH_SERVICE_URL=http://python-graph:64078
GRAPH_SERVICE_TIMEOUT_MS=600000

# NetworkX Configuration
GRAPH_MAX_NODES=100000
GRAPH_MAX_EDGES=500000
GRAPH_CACHE_TTL_SECONDS=3600

# Leiden Algorithm
LEIDEN_RESOLUTION=1.0
LEIDEN_MIN_COMMUNITY_SIZE=3
LEIDEN_ITERATIONS=10
```

---

## 4. Python PDF Service

```bash
# PDF Extraction Service
PDF_SERVICE_URL=http://python-pdf:64079
PDF_SERVICE_TIMEOUT_MS=300000

# Extraction Settings
PDF_MAX_PAGES=100
PDF_DPI=300
PDF_OCR_ENABLED=true
PDF_OCR_LANGUAGE=ron
```

---

## 5. PostGIS / Geospatial

```bash
# PostGIS Settings
POSTGIS_SRID=4326
POSTGIS_DEFAULT_RADIUS_KM=10
POSTGIS_KNN_LIMIT=50

# Territory Calculation
TERRITORY_CONVEX_HULL_BUFFER_KM=1
TERRITORY_MIN_MEMBERS=3
```

---

## 6. Communication Channels

```bash
# WhatsApp (TimelinesAI)
WHATSAPP_API_URL=https://api.timelines.ai
WHATSAPP_API_KEY=${DOCKER_SECRET:timelines_ai_api_key}
WHATSAPP_ACCOUNT_IDS=account1,account2,account3
WHATSAPP_DAILY_LIMIT=1000
WHATSAPP_RATE_LIMIT_PER_SECOND=5

# Email (Instantly.ai)
INSTANTLY_API_KEY=${DOCKER_SECRET:instantly_api_key}
INSTANTLY_CAMPAIGN_ACCOUNT_ID=xxx
EMAIL_DAILY_LIMIT=500
EMAIL_WARMUP_ENABLED=true

# NPS Survey
NPS_SURVEY_COOLDOWN_DAYS=90
NPS_SURVEY_EXPIRY_DAYS=7
NPS_REMINDER_AFTER_DAYS=3
```

---

## 7. External Data Sources

```bash
# ANAF
ANAF_API_URL=https://webservicesp.anaf.ro/AsynchWebService/api/v8
ANAF_BATCH_SIZE=500
ANAF_RATE_LIMIT_DAILY=10000

# Termene.ro
TERMENE_API_URL=https://api.termene.ro
TERMENE_API_KEY=${DOCKER_SECRET:termene_api_key}
TERMENE_RATE_LIMIT_RPM=60

# MADR (Scraping)
MADR_OUAI_URL=https://www.madr.ro/registrul-ouai
MADR_COOPERATIVE_URL=https://www.madr.ro/registrul-cooperative
MADR_SCRAPE_INTERVAL_DAYS=30

# ANM Weather
ANM_ALERTS_URL=https://www.meteoromania.ro/
ANM_POLL_INTERVAL_HOURS=6
```

---

## 8. Nurturing Configuration

```bash
# State Machine
NURTURING_ONBOARDING_DAYS=14
NURTURING_DORMANCY_THRESHOLD_DAYS=90
NURTURING_CHURN_THRESHOLD_DAYS=180

# Churn Detection
CHURN_CRITICAL_THRESHOLD=75
CHURN_HIGH_THRESHOLD=50
CHURN_MEDIUM_THRESHOLD=25
CHURN_EVALUATION_INTERVAL_HOURS=24

# Signal Weights (JSON)
CHURN_SIGNAL_WEIGHTS='{"NEGATIVE_SENTIMENT":0.20,"COMPETITOR_MENTION":0.15,"ORDER_FREQUENCY_DROP":0.15,"PAYMENT_DELAY":0.10,"COMMUNICATION_FADE":0.15,"PRICE_COMPLAINT":0.10,"QUALITY_COMPLAINT":0.05,"SUPPORT_ESCALATION":0.10}'
```

---

## 9. Referral Configuration

```bash
# Referral System
REFERRAL_COOLDOWN_DAYS=30
REFERRAL_EXPIRY_DAYS=30
REFERRAL_MAX_PENDING_PER_CLIENT=3
REFERRAL_CONSENT_TIMEOUT_DAYS=7

# Proximity
PROXIMITY_DEFAULT_RADIUS_KM=10
PROXIMITY_MAX_RESULTS=50

# Rewards
REFERRAL_REWARD_TIER_1_THRESHOLD=1000
REFERRAL_REWARD_TIER_1_VALUE=5
REFERRAL_REWARD_TIER_2_THRESHOLD=5000
REFERRAL_REWARD_TIER_2_VALUE=100
REFERRAL_REWARD_TIER_3_THRESHOLD=5001
REFERRAL_REWARD_TIER_3_VALUE=200
```

---

## 10. Win-Back Configuration

```bash
# Win-Back Campaigns
WINBACK_HIGH_VALUE_THRESHOLD=10000
WINBACK_MEDIUM_VALUE_THRESHOLD=5000
WINBACK_DEFAULT_OFFER_DISCOUNT=10
WINBACK_HIGH_VALUE_OFFER_DISCOUNT=15
WINBACK_OFFER_VALIDITY_DAYS=30
```

---

## 11. KOL Configuration

```bash
# KOL Detection
KOL_MIN_CONNECTIONS=5
KOL_ELITE_THRESHOLD=80
KOL_ESTABLISHED_THRESHOLD=60
KOL_EMERGING_THRESHOLD=40
KOL_EVALUATION_INTERVAL_DAYS=30

# Centrality Weights
KOL_DEGREE_WEIGHT=0.30
KOL_BETWEENNESS_WEIGHT=0.30
KOL_EIGENVECTOR_WEIGHT=0.20
KOL_PAGERANK_WEIGHT=0.20
```

---

## 12. HITL Configuration

```bash
# SLA Times (minutes)
HITL_SLA_CRITICAL=120
HITL_SLA_HIGH=480
HITL_SLA_NORMAL=1440
HITL_SLA_LOW=4320

# Escalation
HITL_ESCALATION_THRESHOLD_PERCENT=80
HITL_AUTO_ASSIGN_ENABLED=true
HITL_WORKLOAD_BALANCE_ENABLED=true
```

---

## 13. Monitoring & Observability

```bash
# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=http://signoz:64070
OTEL_SERVICE_NAME=cerniq-etapa5
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1

# Prometheus
PROMETHEUS_METRICS_PORT=64090
PROMETHEUS_METRICS_PATH=/metrics

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
LOG_INCLUDE_TRACE_ID=true
```

---

## 14. Security & Compliance

```bash
# GDPR
GDPR_DATA_RETENTION_DAYS=730
GDPR_CONSENT_EXPIRY_DAYS=365
GDPR_AUDIT_LOG_RETENTION_DAYS=2555

# Competition Law
COMPETITOR_INTEL_AGGREGATION_ONLY=true
COMPETITOR_PRICE_STORAGE_DISABLED=true
COMPETITOR_INTEL_REVIEW_REQUIRED=true

# Encryption
ENCRYPTION_KEY=${DOCKER_SECRET:encryption_key}
ENCRYPTION_ALGORITHM=aes-256-gcm
```

---

**Document generat**: 2026-01-19  
**Status**: COMPLET âœ…
